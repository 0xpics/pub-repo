<div style="text-align:center; margin-top: 50px; font-family: 'Segoe UI', Arial, sans-serif; color: #333;">
  <h1>üöÄ FibrIA Dashboard: Fullstack AWS</h1>
  
  <button (click)="chamarApi(undefined, undefined, 'minute')" style="padding: 15px 30px; font-size: 18px; cursor: pointer; background: #007bff; color: white; border: none; border-radius: 8px; transition: 0.3s; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
    Consultar Banco de Dados (Tempo Real)
  </button>

  <div style="margin-top: 25px; display: flex; justify-content: center; gap: 15px; flex-wrap: wrap;">
    
    <div style="background: #f0f4f8; padding: 10px; border-radius: 8px; border: 1px solid #d1d9e0;">
      <small style="display: block; color: #666; margin-bottom: 5px; font-weight: bold;">FILTRO R√ÅPIDO (MESES)</small>
      <div style="display: flex; gap: 5px;">
        <button (click)="chamarApi('2026-01-01', '2026-01-31', 'day')" style="padding: 5px 10px; cursor: pointer; background: #28a745; color: white; border: none; border-radius: 4px; font-size: 12px;">Jan/26</button>
        <button (click)="chamarApi('2026-02-01', '2026-02-28', 'day')" style="padding: 5px 10px; cursor: pointer; background: #28a745; color: white; border: none; border-radius: 4px; font-size: 12px;">Fev/26</button>
        <button (click)="chamarApi('2026-03-01', '2026-03-31', 'day')" style="padding: 5px 10px; cursor: pointer; background: #28a745; color: white; border: none; border-radius: 4px; font-size: 12px;">Mar/26</button>
      </div>
    </div>

    <div style="background: #f0f4f8; padding: 10px; border-radius: 8px; border: 1px solid #d1d9e0;">
      <small style="display: block; color: #666; margin-bottom: 5px; font-weight: bold;">CONCEITO: TIME BUCKET</small>
      <div style="display: flex; gap: 5px;">
        <button (click)="chamarApi(undefined, undefined, 'hour')" style="padding: 5px 10px; cursor: pointer; background: #6f42c1; color: white; border: none; border-radius: 4px; font-size: 12px;">
          M√©dia por Hora
        </button>
        <button (click)="chamarApi('2026-01-01', '2026-04-30', 'day')" style="padding: 5px 10px; cursor: pointer; background: #dc3545; color: white; border: none; border-radius: 4px; font-size: 12px;">
          Vis√£o Geral (M√©dia/Dia)
        </button>
      </div>
    </div>
  </div>

  <div style="margin-top: 25px; display: flex; justify-content: center; gap: 15px; flex-wrap: wrap; background: #fff; padding: 15px; border-radius: 10px; border: 1px solid #eee; width: 85%; max-width: 900px; margin-left: auto; margin-right: auto; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
    
    <div style="display: flex; flex-direction: column; align-items: flex-start;">
      <label style="font-size: 11px; font-weight: bold; color: #666; margin-bottom: 2px;">DE:</label>
      <input type="date" #dataInicio style="padding: 5px; border: 1px solid #ccc; border-radius: 4px; font-family: inherit;">
    </div>

    <div style="display: flex; flex-direction: column; align-items: flex-start;">
      <label style="font-size: 11px; font-weight: bold; color: #666; margin-bottom: 2px;">AT√â:</label>
      <input type="date" #dataFim style="padding: 5px; border: 1px solid #ccc; border-radius: 4px; font-family: inherit;">
    </div>

    <div style="display: flex; align-items: flex-end; gap: 5px;">
      <button (click)="chamarApi(dataInicio.value, dataFim.value, 'hour')" 
              style="padding: 8px 15px; cursor: pointer; background: #007bff; color: white; border: none; border-radius: 4px; font-weight: bold; font-size: 12px;">
        üîç Filtrar Per√≠odo
      </button>
      
      <button (click)="chamarApi(dataInicio.value, dataInicio.value, 'minute')" 
              style="padding: 8px 15px; cursor: pointer; background: #17a2b8; color: white; border: none; border-radius: 4px; font-weight: bold; font-size: 12px;">
        üìç Ver s√≥ dia "DE"
      </button>
    </div>
  </div>

  <div style="margin: 30px auto; padding: 25px; background: white; border-radius: 15px; width: 85%; max-width: 900px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); border: 1px solid #eee;">
    <h3 style="color: #007bff; margin-top: 0; display: flex; align-items: center; justify-content: center; gap: 10px;">
      üìä Telemetria em Tempo Real (RDS)
    </h3>
    <div style="height: 350px; position: relative;">
      <canvas #meuGrafico></canvas>
    </div>
  </div>

  <details *ngIf="dados() && dados().length > 0" style="margin-top: 20px; background: #f9f9f9; padding: 10px; border-radius: 8px; display: inline-block; width: 80%; cursor: pointer; border: 1px solid #ddd;">
    <summary style="font-weight: bold; color: #666;">Ver resposta bruta da API (JSON)</summary>
    <div style="margin-top: 15px; background: #ffffff; padding: 15px; border-radius: 5px; border: 1px solid #eee;">
      <pre style="text-align: left; font-size: 12px; overflow-x: auto;">{{ dados() | json }}</pre>
    </div>
  </details>

  <hr style="margin: 50px 0; border: 0; border-top: 2px solid #eee; width: 90%; margin-left: auto; margin-right: auto;">

  <div *ngIf="statusInfra() as info; else carregando" style="max-width: 800px; margin: 0 auto 50px auto; text-align: left; background: #1e1e1e; color: #f4f4f4; padding: 25px; border-radius: 15px; box-shadow: 0 8px 16px rgba(0,0,0,0.3);">
    
    <h2 style="color: #4caf50; border-bottom: 1px solid #333; padding-bottom: 10px; margin-top: 0;">üõ°Ô∏è Status da Infraestrutura (RDS)</h2>

    <div style="display: flex; gap: 20px; margin-top: 20px;">
      <div style="flex: 1; background: #2d2d2d; padding: 15px; border-radius: 8px; border-left: 5px solid #4caf50;">
        <small style="color: #888; font-weight: bold;">PARTICIONAMENTO</small><br>
        <strong style="font-size: 1.1rem;">Estado: ATIVO</strong><br>
        <small style="color: #4caf50;">Motor: pg_partman</small>
      </div>

      <div style="flex: 1; background: #2d2d2d; padding: 15px; border-radius: 8px; border-left: 5px solid #2196f3;">
        <small style="color: #888; font-weight: bold;">OR√áAMENTO RDS</small><br>
        <strong style="font-size: 1.1rem;">{{ info.custo_infra }}</strong><br>
        <small style="color: #2196f3;">Limite: 20GB Free Tier</small>
      </div>
    </div>

    <h3 style="margin-top: 30px; font-size: 1.1rem; color: #4caf50;">Mapa de Tabelas F√≠sicas (Time-Series)</h3>
    <p style="font-size: 0.8rem; color: #aaa;">Segmenta√ß√£o f√≠sica dos dados autom√°tica:</p>
    
    <table style="width: 100%; border-collapse: collapse; margin-top: 10px; background: #262626;">
      <thead>
        <tr style="border-bottom: 2px solid #333; color: #888; font-size: 0.8rem; text-transform: uppercase;">
          <th style="padding: 12px; text-align: left;">Nome da Parti√ß√£o no Banco</th>
          <th style="padding: 12px; text-align: left;">Estado</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let p of info.particoes_ativas" style="border-bottom: 1px solid #333;">
          <td style="padding: 12px; font-family: 'Courier New', monospace; font-size: 0.9rem; color: #81c784;">{{ p.child_table }}</td>
          <td style="padding: 12px;">
            <span style="background: rgba(76, 175, 80, 0.1); color: #4caf50; padding: 4px 8px; border-radius: 4px; font-size: 0.7rem; font-weight: bold;">‚óè PRONTA</span>
          </td>
        </tr>
      </tbody>
    </table>

    <div style="margin-top: 25px; font-size: 0.7rem; color: #555; text-align: center; font-style: italic;">
      Backend: {{ info.motor }}
    </div>
  </div>

  <ng-template #carregando>
    <div style="margin-top: 20px; color: #666; font-style: italic; padding: 40px;">
      <div class="spinner"></div>
      Sincronizando metadados do Amazon RDS...
    </div>
  </ng-template>

</div>

<style>
  .spinner {
    display: inline-block;
    width: 25px;
    height: 25px;
    border: 3px solid rgba(0,123,255,0.1);
    border-top-color: #007bff;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin-right: 10px;
    vertical-align: middle;
  }
  @keyframes spin { to { transform: rotate(360deg); } }
</style>